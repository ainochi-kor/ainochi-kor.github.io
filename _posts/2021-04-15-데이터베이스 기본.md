---
layout: post
author: Tommy Kang
title: 데이터베이스 기본
---

## 트랜잭션
: 인가받지 않은 사용자로부터 데이터를 보장하기 위해 DBMS가 가져야하는 특성.
데이터베이스 시스템에서 하나의 논리적 기능을 정상적으로 수행하기 위한 기본 단위.

### 특성
- 원자성 : 분해가 불가능한 작업의 최소 단위
- 일관성 : 트랜잭션 실행 성공 후 항상 일관된 데이터베이스 상태 보존
- 격리성 : 트랜잭션 실행 중 생성하는 연산의 중간 결과를 다른 트랜잭션이 접근 불가.
- 영속성 : 성공이 완료된 트랜잭션 결과는 영속적으로 데이터베이스에 저장하는 특성

### 상태 설명
- 활동 상태 : 초기 상태
- 부분 완료 상태 : 마지막 명령문이 실행된 후 가지는 상태
- 완료 상태 : 트랜잭션이 성공적으로 완료된 후 가지는 상태
- 실패 상태 : 정상적인 실행이 더 이상 진행될 수 없을 때 가지는 상태
- 철회 상태 : 트랜잭션이 취소되고 데이터베이스가 트랜잭션 시작 전 상태로 환원된 상태

### 트랜잭션 제어 언어
: TCL이라고 하며, 트랜잭션 결과를 허용하거나 취소하는 목적으로 사용되는 언어.
- 커밋 : 트랜잭션을 메모리에 영구적으로 저장하는 명령어
- 롤백 : 트랜잭션 내역을 저장 무효화시키는 명령어
- 체크포인트 : 롤백을 위한 시점을 지정하는 명령어

### 병행 제어(일관성 주요 기법)
: 다수 사용자 환경에서 여러 트랜잭션 수행 시, 데이터베이스 일관성 유지를 위해 상호작용을 제어하는 기법
[목적]
- 데이터베이스 공유 최대화
- 시스템의 활용도 최대화
- 데이터베이스 일관성 유지
- 사용자에 대한 응답시간 최소화

[병행제어 미보장 시 문제점]
- 갱신 손실 : 먼저 실행된 트랜잭션의 결과를 나중에 실행된 트랜잭션이 덮어쓸 때 발생
- 현황 파악 오류 : 중간 수행 결과를 다른 트랜잭션이 참조하여 발생
- 모순성 : 트랜잭션이 동시에 실행되어 데이터의 일관성 결여
- 연쇄복귀 : 부분 취소를 못하는 오류

[병행 제어 기법의 종류]
- 로킹 : DB의 일관성과 무결성 유지를 위해 트랜잭션의 순차적 진행을 보장하는 직렬화 기법.
- 낙관적 검증 : 어떠한 검증도 수행하지 않고 트랜잭션 수행 후 종료 시 검증을 수행하여 DB 반영.
- 타임 스탬프 순서 : 실행 전, 타임 스탬프를 부여하여 부여된 시간에 따라 작업을 수행
- MVCC(다중버전 동시성 제어) : 타임스탬프를 비교하여 직렬가능성이 보장되는 적절한 버전을 선택하여 접근.

### 데이터베이스 고립화 수준(격리성 주요 기법)
: 다른 트랜잭션이 현재의 데이터에 대한 무결성을 해치지 않기 위해 잠금을 설정하는 정도

[종류]
- Read Uncommitted : 연산 중인 데이터를 다른 트랜잭션이 읽는 것을 허용.
- Read Committed : 연산 중 완료될 때까지 대상 데이터 읽기를 제한.
- Repeatable Read : 특정 데이터 읽을 때, 해당 데이터 갱신, 삭제 제한
- Serializable Read : 특정 영역을 순차적으로 읽을 때, 해당 데이터 접근 제한.

### 회복 기법(영속성 주요 기법)
: 트랜잭션을 수행 중 장애로 인해 손상된 데이터베이스를 손상되기 전 정상적인 상태로 복구시키는 작업.

[종류]
(로그 기반 회복 기법)
- 지연 갱신 회복 기법 : 트랜잭션이 완료되기 전까지 데이터베이스 기록하지 않는 기법
- 즉각 갱신 회복 기법 : 트랜잭션 수행 중 갱신 결과를 바로 DB에 반영하는 기법
- 체크 포인트 회복 기법 : 장애 발생시 장애 발생 이전의 상태로 복원시키는 회복 기법
- 그림자 페이징 회복 기법 : 트랜잭션 수행 시 복제본을 생성하여 장애 시 이를 이용해 복구하는 기법


## DDL(데이터 정의어)
: 데이터를 정의하는 언어로 데이터를 담는 그릇을 정의하는 언어.

### 대상
[테이블]
: 데이터를 저장하는 항목인 필드들로 구성된 데이터의 집합체.
(릴레이션, 엔티티라고도 불린다)
- 튜플/행 : 릴레이션에서 같은 값을 가질 수 없다.
- 애트리뷰트/열 : 테이블 내의 열.
- 식별자 : 관계형 데이터베이스에서 각각의 구분할 수 있는 논리적인 개념
- 카디널리티 : 튜플의 개수
- 차수 : 애트리뷰트의 개수
- 도메인 : 하나의 애트리뷰트가 취할 수 있는 같은 타입의 원자값들의 집합

[뷰]
: 논리 테이블로서 사용자 테이블과 동일하다.

특징
- 논리적 데이터 독립성 제공
- 데이터 조작 연산 간소화
- 보안 기능 제공
- 뷰 변경 불가

목적 
- 단순 질의어를 사용할 수 있기 때문.

장점
- 논리적 독립성 제공
- 사용자 데이터 관리 용이
- 데이터 보안의 용이
단점
- 뷰 자체 인덱스 불가
- 뷰 정의 변경 불가
- 데이터 변경 제약 존재

[인덱스]
: 데이터를 빠르게 찾을 수 있는 수단으로 테이블에 대한 조회 속도를 높여주는 자료 구조.

특징
- 기본 키 컬럼은 자동으로 인덱스가 생성된다.
- 인덱스가 없는 경우, 테이블 전체 내용을 검색한다.
- 인덱스가 있는 경우, 데이터를 빠르게 찾을 수 있다.

종류
- 순서 인덱스 : B-Tree 알고리즘 활용한 정렬된 순서로 생성되는 인덱스
- 해시 인덱스 : 해시 함수를 직접 데이터에 키 값으로 접근하는 인덱스
- 비트맵 인덱스 : 각 컬럼에 적은 개수 값이 저장된 경우 선택하는 인덱스
- 함수 기반 인덱스 : 수식이나 함수를 적용하여 만든 인덱스
- 단일 인덱스 : 하나의 컬럼으로만 구성한 인덱스
- 결합 인덱스 : 두 개 이상의 컬럼으로 구성한 인덱스
- 클러스터드 인덱스 : 기본 키 기준으로 레코드를 묶어서 저장하는 인덱스

스캔 방식
- 인덱스 범위 스캔 
- 인덱스 전체 스캔
- 인덱스 단일 스캔
- 인덱스 생략 스캔

### DDL 명령어
- CREATE : 데이터베이스 오브젝트 생성하는 명령어
- ALTER : 데이터베이스 오브젝트 변경하는 명령어
- DROP : 데이터베이스 오브젝트 삭제하는 명령어
- TRUNCATE : 데이터베이스 오브젝트 내용 삭제하는 명령어

``` 
CREATE TABLE 테이블명
(
	컬럼명 데이터타입 PRIMARY KEY, — 기본키 설정
	컬럼명 데이터타입 FOREIGN KEY REFERENCES 참조테이블(기본키), — 외래키 설정
	컬럼명 데이터타입 UNIQUE,
	컬럼명 데이터타입 NOT NULL,
	컬럼명 데이터타입 CHECK(조건식), — 제약조건 설정
	컬럼명 데이터타입 DEFAULT 값
)
```

``` 
CREATE TABLE 사원
(
	사번 VARCHAR(10) PRIMARY KEY, — 기본키 설정
	컬럼명 VARCHAR(20) FOREIGN KEY REFERENCES 참조테이블(기본키), — 외래키 설정
	컬럼명 데이터타입 UNIQUE,
	컬럼명 데이터타입 NOT NULL,
	컬럼명 데이터타입 CHECK(조건식), — 제약조건 설정
	컬럼명 데이터타입 DEFAULT 값
)
```

####제약 조건
PRIMARY KEY : 테이블의 기본 키를 정의
FOREIGN KEY : 외래 키로, 참조 대상을 테이블(컬럼명)으로 명시
UNIQUE : 테이블 내에서 얻은 유일한 값을 갖도록 하는 제약 조건
CHECK : 개발자가 정의하는 제약조건
DEFAULT : 데이터를 추가할 때, 값을 넣지 않는 경우, 설정해 둔 기본값으로 설정해주는 조건.

ALTER TABLE 테이블명 ADD 컬럼명 데이터타입 [제약조건];
ALTER TABLE 테이블명 MODIFY 컬럼명 데이터타입 [제약조건];
ALTER TABLE 테이블명 DROP 컬럼명;

DROP TABLE 테이블명 [CASCADE/RESTRICT];
CASCADE : 참조하는 테이블까지 연쇄적으로 제거하는 옵션
RESTRICT : 다른 테이블이 삭제할 테이블을 참조중이면 제거하지 않는 옵션

TRUNCATE TABEL 테이블명 ;
: 테이블 내의 데이터들을 삭제하는 명령어이다.

#### VIEW

CREATE OR REPLACE VIEW 뷰이름 AS 조회쿼리;
DROP VIEW 뷰이름;

#### INDEX
CREATE [UNIQUE] INDEX 인덱스명 ON 테이블명(컬럼명1, 컬럼명2, ...);
ALTER [UNIQUE] INDEX 인덱스명 ON 테이블명(컬럼명1, 컬럼명2, ...);
DROP INDEX 인덱스명;
 
### DML(데이터 조작어)
: 데이터베이스에 저장된 자료들을 입력, 수정, 삭제, 조회하는 언어.

SELECT - 조회 - 테이블 내 칼럼에 저장된 데이터를 조회
INSERT - 삽입 - 테이블 내 칼럼에 데이터를 추가
UPDATE - 갱신 - 테이블 내 칼럼에 저장된 데이터를 수정
DELETE - 삭제 - 테이블 내 칼럼에 저장된 데이터를 삭제

#### SELECT 
SELECT [ALL / DISTINCT] 속성명1, 속성명2 ...
FROM 테이블명, ...
[WHERE 조건]
[GROUP BY 속성명1, 속성명2 ....]
[HAVING 그룹조건]
[ORDER BY 속성 [ASC / DESC] ];

WHERE
비교 ( =, <>, !=, <, <=, >, >= )
범위 ( 컬럼  BETWEEN 값 AND 값2 )
집합 ( IN, NOT IN)
패턴 ( LIKE )
NULL ( IS NULL, IS NOT NULL )
복합조건 ( AND, OR, NOT, ! )

#### JOIN(조인)
내부 조인
SELECT A.컬럼1, A.컬럼2, ... , B.컬럼1, B.컬럼2, ...
FROM 테이블1 A [INNER] JOIN 테이블2 B
ON 조인조건
[WHERE 검색조건 ];

왼쪽 외부 조인
SELECT A.컬럼1, A.컬럼2, ... , B.컬럼1, B.컬럼2, ...
FROM 테이블1 A LEFT [OUTER] JOIN 테이블2 B
ON 조인 조건
[WHERE 검색조건]

오른쪽 외부 조인
SELECT A.컬럼1, A.컬럼2, ... , B.컬럼1, B.컬럼2, ...
FROM 테이블1 A RIGHT [OUTER] JOIN 테이블2 B
ON 조인조건
[WHERE 검색조건]

완전 외부 조인
SELECT A.컬럼1, A.컬럼2, ... , B.컬럼1, B.컬럼2, ...
FROM 테이블1 A FULL [OUTER] JOIN 테이블2 B
ON 조인조건
[WHERE 검색조건]

교차 조인
SELECT 컬럼1, 컬럼2, ...
FROM 테이블1 CROSS JOIN 테이블2

셀프 조인
SELECT A.컬럼1, A.컬럼2, ..., B.컬럼1, B.컬럼2
FROM 테이블1 A [INNER] JOIN 테이블1 B 
ON 조인 조건 
[WHERE 검색조건]

서브쿼리
SELECT 절 서브쿼리
FROM 절 서브쿼리
WHERE 절 서브쿼리

집합 연산자
UNION : 중복 행이 제거된 쿼리 결과를 반환
UNION ALL : 중복 행이 포함된 쿼리를 반환
INTERSECT : 중복 행 쿼리를 반환
MINUS : 첫 쿼리에 있고 두 번째 쿼리에는 없는 것을 

#### INSERT(데이터 삽입) 명령어
INSERT INTO 테이블명(속성명1, ...) 
VALUES ( 데이터1, ...);

#### UPDATE(데이터 변경) 명령어
UPDATE 테이블명 
SET 속성명 = 데이터, ... 
WHERE 조건;

#### DELETE(데이터 삭제) 명령어
DELETE FROM 테이블명 
WHERE 조건;

### DCL (데이터 제어어)
GRANT 권한 ON 테이블 TO 사용자;
REVOKE 권한 ON 테이블 FROM 사용자;